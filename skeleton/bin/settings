#!/bin/sh

# settings: a frontend for all configuration wizards

# check whether Dropbear is running
if [ -n "$(pidof dropbear)" ]
then
	dropbear="true"
else
	dropbear="false"
fi

# check whether tftpd is running
if [ -n "$(pidof tftpd)" ]
then
	tftpd="true"
else
	tftpd="false"
fi

eval $(echo "<wtitle>Settings</wtitle>
<hbox>
	<hbox>
		<vbox>
			<button>
				<label>Wireless Wizard</label>
				<action>EXIT=wifi-wizard</action>
			</button>
			<button>
				<label>Package Manager</label>
				<action>EXIT=gpackdude</action>
			</button>
		</vbox>
		<vseparator></vseparator>
		<vbox>
			<checkbox>
				<label>Dropbear</label>
				<default>$dropbear</default>
				<variable>dropbear</variable>
				<action>EXIT=dropbear</action>
			</checkbox>
			<checkbox>
				<label>tftpd</label>
				<default>$tftpd</default>
				<variable>tftpd</variable>
				<action>EXIT=tftpd</action>
			</checkbox>
		</vbox>
	</hbox>
</hbox>" | gtkdialog1 -s)

case "$EXIT" in
	dropbear)
		if [ "true" = "$dropbear" ]
		then
			sh /etc/init.d/02-dropbear start
		else
			sh /etc/init.d/02-dropbear stop
		fi
		;;

	tftpd)
		if [ "true" = "$tftpd" ]
		then
			sh /etc/init.d/03-tftpd start
		else
			sh /etc/init.d/03-tftpd stop
		fi
		;;

	gpackdude|wifi-wizard)
		exec "$EXIT" 
		;;

	*)
		exit 1
		;;
esac
