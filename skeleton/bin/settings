#!/bin/sh

# settings: a frontend for all configuration wizards

# check whether Dropbear is running
if [ -n "$(pidof dropbear)" ]
then
	dropbear="true"
else
	dropbear="false"
fi

# check whether bftpd is running
if [ -n "$(pidof bftpd)" ]
then
	bftpd="true"
else
	bftpd="false"
fi

eval $(echo "<window>
	<hbox>
		<hbox>
			<vbox>
				<button>
					<label>Wireless Wizard</label>
					<action>EXIT=wifi-wizard</action>
				</button>
				<button>
					<label>Package Manager</label>
					<action>EXIT=gpackdude</action>
				</button>
			</vbox>
			<vseparator></vseparator>
			<vbox>
				<checkbox>
					<label>Dropbear</label>
					<default>$dropbear</default>
					<variable>dropbear</variable>
					<action>EXIT=dropbear</action>
				</checkbox>
				<checkbox>
					<label>bftpd</label>
					<default>$bftpd</default>
					<variable>bftpd</variable>
					<action>EXIT=bftpd</action>
				</checkbox>
			</vbox>
		</hbox>
	</hbox>
</window>" | gtkdialog1 -s)

case "$EXIT" in
	dropbear)
		if [ "true" = "$dropbear" ]
		then
			sh /etc/init.d/02-dropbear
		else
			killall dropbear
		fi
		;;

	bftpd)
		if [ "true" = "$bftpd" ]
		then
			sh /etc/init.d/03-bftpd
		else
			killall bftpd
		fi
		;;

	gpackdude|wifi-wizard)
		exec "$EXIT" 
		;;

	*)
		exit 1
		;;
esac
